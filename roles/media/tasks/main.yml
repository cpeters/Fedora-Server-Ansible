#
# Install media packages and Intel specific libraries
#
- name: Install DNF packages from list
  become: yes
  tasks:
    - name: Install packages
      dnf:
        name:
          - ffmpeg
          - ffmpeg-libs
          - gstreamer-ffmpeg
          - gstreamer1-libav
          - gstreamer1-plugin-openh264
          - gstreamer1-plugins-{base,bad-*,good-*}
          - lame*
          - libva
          - libva-utils
          - vlc
        exclude:
          - gstreamer1-plugins-bad-free-devel
          - lame-devel
        state: present
        update_cache: yes

#
# With newer Intel chipsets we want to swap the libva media driver for the intel media driver
# TODO: find reference to docs on this
#
- name: Swap DNF packages
  become: yes
  tasks:
    - name: Execute dnf swap command
      dnf:
        name: libva-intel-media-driver
        newname: intel-media-driver
        state: present
        allow_erasing: yes

- name: Install Flatpak apps
  become: yes
  tasks:
    - name: Install flatpak
      dnf:
        name: flatpak
        state: present

    - name: Add Flathub remote
      command: flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

    - name: Install Flatpak apps
      command: flatpak install -y flathub {{ item }}
      loop:
        - me.hyliu.fluentreader
        - io.freetubeapp.FreeTube
        - md.obsidian.Obsidian

